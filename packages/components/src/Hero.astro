---
import { Image } from "astro-preload/components";

type Image = { url: string, title: string };

interface Props {
    images: Image[];
}

const { images } = Astro.props as Props;
---

<div class="hero">
    <div class="carousel">
        {
            images.map((image) => (
                <div class="carousel-item">
                    <Image
                        url={image.url}
                        alt={image.title}
                    />
                    <p>
                        <strong>Foto:</strong> {image.title}
                    </p>
                </div>
            ))
        }
    </div>
    <div class="hero-content">
        <slot />
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const items: HTMLDivElement[] = Array.from(
            document.querySelectorAll(".carousel-item"),
        );
        let currentIndex = 0;

        setInterval(() => {
            const oldIndex = currentIndex;
            currentIndex = (currentIndex + 1) % items.length;
            for (let i = 0; i < items.length; i++) {
                if (i === oldIndex) {
                    items[oldIndex].style.transform =
                        window.innerWidth >= 650
                            ? "translateX(-80vw)"
                            : "translateX(-100vw)";
                    setTimeout(() => {
                        items[i].style.display = "none";
                        items[i].style.transform =
                            window.innerWidth >= 650
                                ? "translateX(80vw)"
                                : "translateX(100vw)";
                        setTimeout(
                            () => (items[i].style.display = "block"),
                            1500,
                        );
                    }, 1500);
                } else if (i === currentIndex) {
                    items[currentIndex].style.transform = "translateX(0)";
                }
            }
        }, 4000);
    });
</script>

<style lang="scss">
    .hero {
        width: 100%;
        height: 100%;
        position: relative;

        .carousel {
            overflow: hidden;
            display: grid;
            position: relative;

            .carousel-item {
                transform: translateX(100vw);
                transition: transform 1.5s ease-in-out;
                grid-area: 1 / 1;

                &:first-of-type {
                    transform: translateX(0);
                }

                img {
                    width: 100vw;
                    height: calc(100vh - 6rem);
                    object-fit: cover;
                    filter: brightness(75%);
                }

                p {
                    position: absolute;
                    bottom: 1rem;
                    right: 2rem;
                    font-size: 0.75rem;
                }
            }
        }

        .hero-content {
            position: absolute;
            top: 0;
            left: 0;
        }
    }

    @media screen and (min-width: 650px) {
        .hero {
            width: 80vw;
            margin: 0 auto;

            .carousel {
                border-radius: 1rem;
                overflow: hidden;
                box-shadow: 0px 10px 20px 0px rgba(0, 0, 0, 0.3);

                .carousel-item {
                    transform: translateX(80vw);
                    height: 60vh;
                    width: 80vw;

                    img {
                        width: 100%;
                        height: 100%;
                    }
                }
            }
        }
    }
</style>